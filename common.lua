DIALOGUE_DAMAGEDEALT = {
    {"$animal_shotgunner", "Gotcha.", "Blood, blood!", "I hope that hurt."},
    {"$animal_zombie", "Tasty!", "Rah!", "Spill your blood!"},
    {"$animal_chest_mimic", "Fool! FOOOOL!", "Boo! I bet you didn't expect that!", "Hahaha! Got ya!"},
    {"$animal_dark_alchemist", "EAHAHAHA!", "HAHA!!", "MUAHAHAHA!"},
    {"$animal_shaman_wind", "EAHAHAHA!", "HAHA!!", "MUAHAHAHA!"},
    {"$animal_longleg", "Fall before us!", "Fear us!", "We are legion!"},
    {"$animal_miner", "Nice catch! Haha...", "Kaboom!", "I expected more from you."},
    {"$animal_firemage", "You're a fool!", "You'd best run while you still can.", "I like my food cooked well-done."},
    {"$animal_slimeshooter", "Splat!", "Are you feeling the toxicity yet?", "Let it seep into your skin..."},
    {"$animal_acidshooter", "Meet your end.", "Goodbye.", "You won't be missed."},
    {"$animal_giantshooter", "Fuel for the fire...", "You taste terrible.", "You will become food for my children!"},
    {"$animal_frog", "Konna used Tackle!", "I got you!", "Watch me fly!"},
    {"$animal_frog_big", "Blah!", "Blorp!", "Mlem!"},
    {"$animal_miner_fire", "Eat this!", "Serves you right!", "Feel the burn!"},
    {"$animal_graham_miner_gasser", "Breathe it in...", "I wear this hazmat suit for a reason.", "It's nothing personal. Let's try to make it quick."},
    {"$animal_boss_pit", "Experience the TRUE power of magic!", "How does it feel? Does it hurt? Good.", "Prepare to meet your end!", "Be grateful that one didn't polymorph you.", "You'll never amount to anything. You'll just become corrupt...", "I hate plasma. It burns the eye..."},
    {"$animal_shaman", "A curse upon you!", "None of you are free of sin...", "You will be missed."},
    {"$animal_playerghost", "Blame only yourself for this!", "I feel your pain. Haha... what irony.", "Don't fret. You're only one in " .. 1 + StatsGlobalGetValue( "death_count" ) .. "."},
    {"$animal_firebug", "Stand down, intruder!", "Together, we're strong!", "This is our domain! Get out!"},
    {"$animal_bigfirebug", "I'll burn you to a crisp!", "For the Hive, I'll take you down!", "This is my domain! Leave while you still can!"},
    {"$animal_fireskull", "Your end is near!", "I've got you now!", "Raaah!"},
    {"$animal_bat", "Tear them to pieces!", "Bomp.", "Splat."},
    {"$animal_bigbat", "Let's knock them down!", "Stun them, stop them!", "Now! Swarm!"},
    {"$animal_sniper", "If anyone's getting this done, it's going to be me.", "If you forfeit now, I might spare your life! Heh...", "Ouch, you might need surgery after that one."},
    {"$animal_scavenger_grenade", "You're just making my job easier!", "Do you need me to go easy on you?", "Come back when you've learned to dodge!"},
    {"$animal_thundermage", "Farewell, this is your end!", "Feel the electric shock run through your body...", "Oh, this is almost too easy...!"},
    {"$animal_goblin_bomb", "Shrapnel! Pain!", "Haha, yes!", "I did it!"},
    {"$animal_scavenger_heal", "Are you feeling better?", "I hope that helps.", "Deep breaths. You're gonna be okay."},
    {"$animal_boss_alchemist", "Oh, child... If only you knew.", "You're not even worth saving.", "Count this as a mercy kill. You wouldn't want to be like them.", "Life, death, or somewhere in between...? For you, I've chosen death.", "A shame, too... You could have been so great.", "Nothing? Not even a cry of pain? How daft."},
    {"$animal_parallel_tentacles", "Now die. For magic. You monster.", "Justice is served.", "You deserve no apologies."},
    {"$animal_parallel_alchemist", "Forfeit yourself. Don't end up like me...", "Don't go any further. Damnation awaits you.", "Reality grows more unstable because of you."},
    {"$animal_wizard_poly", "If you survive this, I'll be impressed...", "Are you feeling a bit sheepish...?", "You look rather pale."},
    {"$animal_wizard_dark", "Do you see what I see?", "Rest your weary eyes.", "Open your third eye."},
    {"$animal_wizard_tele", "And off you go!", "Uhuhu! Chaos for you!", "Here's a magic trick: watch this fool disappear!"},
    {"$animal_wizard_returner", "Be not afraid. It's just your reflection.", "Right back at ya!", "That's a taste of your own medicine."},
    {"$animal_wizard_swapper", "Oh! What?!", "No, I just wanted to have fun...!", "Oops...! haha."},
    {"$animal_wizard_neutral", "Signal lost.", "That's all, folks!", "Your move."},
    {"$animal_wizard_twitchy", "Ha-ah-aha...", "G-g-gotcha!", "F-f-feeling just like me?"},
    {"$animal_wizard_hearty", "Half and half and half again.", "I'll round you down to zero.", "You better not collect a heart after this."},
    {"$animal_wizard_weaken", "It's now or never.", "You are now no longer invulnerable. Enjoy.", "Weakening curse? What curse could surpass me?"},
    {"$animal_wizard_homing", "This time it's gotta work, for sure!", "Come, my fellow Masters! Attack now!", "It's not Boomerang Spells, but it'll do."},
    {"$animal_barfer", "I'm confused. W-what happened...?", "I did it? ...I did it!", "Oh... h-hooray!"},
    {"$animal_necromancer_shop", "Your run ends here!", "Beware justice's power! Fear it well!", "I'll snap you in half!"},
    {"$animal_necromancer_super", "I'll send you straight to our Gods, and you'll answer for your sins there.", "By divine wrath, you'll die today!", "I see right through you. You knew this was coming."},
}

DIALOGUE_DAMAGETAKEN = {
    {"$animal_shotgunner", "Augh!", "You'll pay for that!", "That hurts..."},
    {"$animal_zombie", "Leave me...", "This is my end.", "Are you hungry too?"},
    {"$animal_chest_mimic", "Hey! Knock it off!", "Shh, you'll ruin the disguise!", "I'm hiding, stop it!"},
    {"$animal_dark_alchemist", "This disguise usually works... What a shame.", "Damn. Maybe I'll get you next time.", "Fine, then. I'll remember this."},
    {"$animal_shaman_wind", "This disguise always works! What gives?", "Damn it! You found me!", "Fine, then. I'll kill you next time."},
    {"$animal_longleg", "No!", "Ahh!", "Fight us!"},
    {"$animal_miner", "I'll blow you to pieces!", "Bring it on!", "Beware!"},
    {"$animal_firemage", "You'll need more than that to take me down.", "That hurts... a little bit.", "Who do you think you are?"},
    {"$animal_slimeshooter", "Just wait 'til my mom hears about this!", "If I was able to spit acid instead, you'd be screwed!", "Splat!"},
    {"$animal_acidshooter", "Look into my eye!", "Keep your distance.", "I'll corrode you down to nothing."},
    {"$animal_giantshooter", "My children...", "If I were you, I wouldn't!", "See what good killing me will do for you."},
    {"$animal_frog", "I'm just a little frog...", "Owie!", "Hey, that hurts!"},
    {"$animal_frog_big", "That's unfortunate.", "I don't blame you.", "Is this necessary?"},
    {"$animal_miner_fire", "I'll get my revenge.", "I hope you burn.", "How dare you!"},
    {"$animal_graham_miner_gasser", "My gas is stronger than sludge. Take my word for it.", "If only this suit protected from more than just toxicity...", "Now you're starting to annoy me."},
    {"$animal_boss_pit", "You came here just to challenge me?", "You're an utter fool!", "I'm still alive, which means that you've not done your job properly.", "What, do you want it to be a fair fight? Ha ha ha.", "Go jump in the lava lake.", "Am I the strongest opponent you'll face? That's sad."},
    {"$animal_shaman", "I won't forgive you for this.", "Step back, child...", "Stormy skies await you."},
    {"$animal_playerghost", "Do you see your reflection in me?", "Don't feel guilty. This isn't my first time dying.", "I see potential in this one. Good luck..."},
    {"$animal_firebug", "You'll regret this.", "There's always an ally behind me, I'm sure of it.", "Backup! Hive, I need backup!"},
    {"$animal_bigfirebug", "I'll turn you into ash for that!", "The Hive never forgets.", "Perish!"},
    {"$animal_fireskull", "I'm after you.", "Get over here!", "Argh!"},
    {"$animal_bat", "I'm coming for you!", "No!", "I'll take one for the team!"},
    {"$animal_bigbat", "Be slowed to a crawl.", "Soon enough, you'll be swarmed.", "Mmhmm..."},
    {"$animal_sniper", "I could end your life with my eyes closed!", "Hey, that one almost hurt.", "I was going easy on you."},
    {"$animal_scavenger_grenade", "Do your worst!", "I think I broke something...", "H-hey, is there a healer nearby? Help!"},
    {"$animal_thundermage", "I'm as tough as diamonds! Just try me!", "Don't let your guard down, fool. I can still blast you to pieces.", "Don't get cocky. One slip-up, and you're done for!"},
    {"$animal_goblin_bomb", "Oh, noo!", "I changed my mind! Leave me alone!", "No, no!"},
    {"$animal_scavenger_heal", "Show some respect!", "Hey! Don't be mean!", "B-but... There's many more people that need healing!"},
    {"$animal_boss_alchemist", "You should join us... We lack someone with your willpower. Heh heh heh.", "Faceless and nameless... You remind me of myself.", "Come closer. Let me get a good look at you.", "Don't look at me like you know me. It's offputting.", "Did the sight of my underlings upset you? Trust me, you haven't seen the half of it.", "I'll be missed if someone ends my life. Can you say that for yourself?"},
    {"$animal_parallel_tentacles", "Although I'm just a husk... I can end you all the same.", "It would be so easy to just give up now.", "Some day I'll come out from under you."},
    {"$animal_parallel_alchemist", "Life without living... is that what you seek?", "You're already a shadow of who you once were.", "You can't put me back together. So end it."},
    {"$animal_wizard_poly", "This is why I like sheep more than people.", "Hurt me all you want, I'm unstoppable!", "You won't find me so helpless once I polymorph you!"},
    {"$animal_wizard_dark", "Too bright...", "Watch your blind spot.", "I wish you would just disappear."},
    {"$animal_wizard_tele", "You can't stop chaos's reign!", "Teleport away, now!", "I didn't know that that ring of teleportitis was cursed..."},
    {"$animal_wizard_returner", "You just wait 'till I fire that right back!", "Wanna play tennis? Back, forth, back, forth...", "Imitation is the sincerest form of flattery."},
    {"$animal_wizard_swapper", "Can't catch me!", "You're too slow!", "Uahaha!"},
    {"$animal_wizard_neutral", "NULL_EXCEPTION", "Czzzt!", "L-let's go to commercial."},
    {"$animal_wizard_twitchy", "Mm-h!", "Y-you w-won't miss me.", "Y-you're just j-jealous that I'm faster..."},
    {"$animal_wizard_hearty", "Urgh... my blood, my blood...", "Salt in the wound.", "At least I don't try to hide it."},
    {"$animal_wizard_weaken", "I'm already over it.", "Nothing I can say will convince you to stop.", "Perhaps you know better than I do."},
    {"$animal_wizard_homing", "I hope you're not using homing. That'd be hypocritical.", "I see a few ways this could go.", "Well, that's just rude."},
    {"$animal_barfer", "Yeow! Keep that thing away from me!", "H-hey! Stop that!", "H-haven't you heard? T-treat others as you... o-ow..."},
    {"$animal_necromancer_shop", "Oh, you'll pay for that one!", "It'll only get worse for you if you resist!", "I would have loved to get to know you better, in different circumstances."},
    {"$animal_necromancer_super", "You may have taken down our, ahem, lesser guards, but it's not over.", "The Gods never forget your sins.", "Face it -- you're in way over your head on this one."},
}

DIALOGUE_IDLE = {
    {"$animal_shotgunner", "Who are you?", "I want to take a nap.", "This is my territory!"},
    {"$animal_zombie", "Hungry... so hungry!", "Must feed...", "Where are you?"},
    {"$animal_chest_mimic", "...", "", ""}, -- intentionally blank
    {"$animal_dark_alchemist", "", "", ""}, -- intentionally blank
    {"$animal_shaman_wind", "", "", ""}, -- intentionally blank
    {"$animal_longleg", "Strong in numbers...", "Weak in strength...", "Where's food?"},
    {"$animal_miner", "Need me to dig a hole?", "Where did everyone go?", "Friend?"},
    {"$animal_firemage", "The fire is so calming...", "Does anyone have a tablet? They don't burn in my hand like books do.", "Not much for conversation, eh?"},
    {"$animal_slimeshooter", "Cleansing sludge...", "I wish I could spit acid.", "Gurgle, blop."},
    {"$animal_acidshooter", "I see you.", "I can see you through the dark.", "Death is near!"},
    {"$animal_giantshooter", "Bloated...", "Ugh...", "What was that?"},
    {"$animal_frog", "Ribbit.", "Hop, hop.", "Meow."},
    {"$animal_frog_big", "Robbit.", "Skip, jump.", "Woof."},
    {"$animal_miner_fire", "I'll burn this whole place down!", "Don't look at me like that!", "You're flammable! All of you!"},
    {"$animal_graham_miner_gasser", "Don't worry, I kill cleanly.", "I can singlehandedly lower air quality by over " .. tostring(Random(50, 100)) .. ".", "Am I really the most level-headed one here?"},
    {"$animal_boss_pit", "I know you're here. Show yourself!", "A coward. You are a coward!", "Power corrupts. We both know that well.", "One of these days... I'll cast a black hole and burrow my way out of this place.", "I enjoy reading as well as obliterating unwise explorers.", "What, do you expect me to make small talk?"},
    {"$animal_shaman", "No one really knows...", "Will you remember me?", "Hm? Oh, it's nothing..."},
    {"$animal_playerghost", "Where have I gone? This isn't my world...", "Risen from my grave... I'll soon return to it.", "I feel lost... am I truly the only one?"},
    {"$animal_firebug", "Bzzt...", "We serve the Hive...", "Regroup and prepare to swarm."},
    {"$animal_bigfirebug", "Bzzt!", "I must protect the Hive!", "I can handle it by myself!"},
    {"$animal_fireskull", "I smell smoke!", "I'm comin' for ya!", "Heeheehee..."},
    {"$animal_bat", "Flap, flap, squeak...", "Blah...", "I'm craving something sweet."},
    {"$animal_bigbat", "Will my children ever get the chance to grow up...?", "Peace and quiet, please?", "I'm craving something salty."},
    {"$animal_sniper", "I'll strike you down... if you're close by or if you're far away.", "I know you're there. Don't try anything funny.", "...I'm not just talking to myself here, am I?"},
    {"$animal_scavenger_grenade", "I should go get a drink after this...", "What day is it? I think rent's due soon...", "I need more coffee..."},
    {"$animal_thundermage", "My clothing? It's custom-made, thank you very much...", "If you can hear my electric crackle, you're too close.", "Magic keeps me alive... and makes so many other things dead."},
    {"$animal_goblin_bomb", "Hrmm...", "Shiny, sparkly glitter...", "What was that sound?"},
    {"$animal_scavenger_heal", "Does anyone need healing?", "I love my job.", "This place is filthy!"},
    {"$animal_boss_alchemist", "Wonders you can't have...", "And yet, there's something missing.", "Is my vision failing me? Or...", "I sense that you're nearby. Do you seek enlightenment?", "Let's make this quick, then.", "If only things went differently, so long ago..."},
    {"$animal_parallel_tentacles", "I feel our reality ripping at the seams...", "I see no evil, and yet evil remains.", "Three eyes count down to one. And then the whole world goes dark."},
    {"$animal_parallel_alchemist", "It'll all be torn apart if this doesn't stop...", "Where are our Gods now?", "The end is near."},
    {"$animal_wizard_poly", "Pink is my favourite colour.", "My flock is looking a bit small...", "Stay back, I'd rather not get blood on my robe..."},
    {"$animal_wizard_dark", "Purple is my favourite colour.", "Where have you gone?", "Something else lurks beyond."},
    {"$animal_wizard_tele", "Yellow is my favourite colour.", "Peekaboo!", "Instability is my specialty."},
    {"$animal_wizard_returner", "Cyan is my favourite colour.", "Fun fact: It is impossible to outrun your own reflection.", "I see you staring. I'm staring back."},
    {"$animal_wizard_swapper", "Blue is my favourite colour.", "Who's ready for some shenanigans? You better be!", "It's all just a game! Why not have some fun with it?"},
    {"$animal_wizard_neutral", "Silver is my favourite colour.", "Have you tried turning it off and on again?", "Biological... technological..."},
    {"$animal_wizard_twitchy", "Green is my f-favourite colour.", "H-hard to focus... hard to s-stay still...", "It's o-out of my control..."},
    {"$animal_wizard_hearty", "Red is my favourite colour.", "What? A helmet? Why would I wear a helmet?", "Do you think I look gross? That's rude."},
    {"$animal_wizard_weaken", "White is my favourite colour.", "What's behind the mask? ...Stay in your own lane.", "Perhaps I look just like you, down below. Or perhaps not."},
    {"$animal_wizard_homing", "Crimson is my favourite colour.", "Don't touch my head.", "Don't call me self-absorbed!"},
    {"$animal_barfer", "M-my favourite color is... o-oh, I don't remember...", "H-hurp... I feel terrible...", "They kicked me out because I p-puked on a tapestry..."},
    {"$animal_necromancer_shop", "Who dares desecrate the Gods' holy land?!", "Let's make this quick... I have a meeting soon.", "If anyone moves these statues around, I'm gonna be mad!"},
    {"$animal_necromancer_super", "I may have skipped leg day, but I'd never skip arm day.", "I'd prefer not to waste any more time on something like this.", "You've made your mistakes. Time to face the consequences."},
}

GENERIC_HOLDINGWAND = {
    "Hey, how do you work this thing?", "Guys, look at this thing I found! Isn't this cool?", "Hey, does anyone here own this? No? Finders keepers.", "If I write my name on this, that means it's mine, right?", "Oh, this thing has spells on it? I just wanted to hit someone with it...", "I have no idea what this does, but I'm not afraid to use it!", "Oh boy, I hope this one is a nuke!", "...Hey, how do I put bullets into this?",
}
GENERIC_CHARMED = {
    "I'm just happy to be here.", "Hello! How are you? I love you.", "Friendship...", "You're my best friend.", "Hehe...",
}
GENERIC_ONFIRE = {
    "Ow, ow!", "Aaah!", "Water! Need water, quickly!", "Someone help!", "Fire! Fire!!",
}
GENERIC_PEACEFULENDING = {
    "This is nice.", "Thank you, player!", "So peaceful... so nice!", "I feel so happy!", "I can finally take a nap...",
}
GENERIC_DRUNK = {
    "Hic...", "Y-you're funny.", "Burp.", "My head hurts...", "Oof, I've had too much.",
}
GENERIC_BERSERK = {
    "I'll kill you all!", "Prepare to die!", "I'll tear you all to pieces!", "None of you are my allies!", "Surrender now! Die! Die!",
}
GENERIC_TOXIC = {
    "Oh, I feel gross...", "Cough, hack...", "My head hurts...", "I feel like I'm gonna be sick...", "It hurts...",
}
GENERIC_CONFUSED = {
    "!?no gniog si kceh eht tahW", "!desufnoc os m'I", "...struh daeh yM", "!?tahW", "!em fo ffo ffuts siht teG",
}

function Speak(entity, text, pool)
    SetRandomSeed(entity + 2352, GameGetFrameNum() - 24806)
    local size = 0.7
    local textComponent = EntityGetFirstComponentIncludingDisabled(entity, "SpriteComponent", "graham_speech_text")
    if textComponent then return end

    local offset_y = 26
    local name = EntityGetName(entity) or ""
    local special_offsets = {
        {"$animal_boss_alchemist", 60},
        {"$animal_parallel_alchemist", 60},
        {"$animal_boss_pit", 15},
        {"$animal_parallel_tentacles", 15},
        {"$animal_necromancer_shop", 10},
        {"$animal_necromancer_super", 12},
    }
    for i = 1, #special_offsets do
        if special_offsets[i][1] == name then
            offset_y = offset_y + special_offsets[i][2]
        end
    end

    -- special idle functionality
    if GameHasFlagRun("PERK_PICKED_PEACE_WITH_GODS") and (pool == "IDLE" or pool == "GENERIC") then
        if name == "$animal_necromancer_shop" then
            local passive_necromancer = {
                "I suppose I can let it slide. But just this once!",
                "Don't think that this means that you're off the hook...",
                "Fine... harumph.",
            }
            text = passive_necromancer[Random(1, #passive_necromancer)]
        end
        if name == "$animal_necromancer_super" then
            local passive_necromancer = {
                "A sinful being you are... But perhaps a little bit endearing.",
                "Don't be mistaken. It is by command of the gods that I spare your life today.",
                "I'm sure you have your reasons. But so do I.",
            }
            text = passive_necromancer[Random(1, #passive_necromancer)]
        end
    end

    if name == "$animal_wizard_returner" and pool == "IDLE" then
        local x, y = EntityGetTransform(entity)
        local mimic = EntityGetClosestWithTag(x, y, "graham_speaking")
        if mimic ~= nil then
            local x2, y2 = EntityGetTransform(mimic)
            local distance = math.sqrt((x2 - x)^2 + (y2 - y)^2)
            if distance > 5 and distance < 250 then
                local comp = EntityGetFirstComponent(mimic, "SpriteComponent", "graham_speech_text")
                if comp ~= nil then
                    text = ComponentGetValue2(comp, "text")
                end
            end
        end
    end

    EntityAddTag(entity, "graham_speaking")
    EntityAddComponent2(entity, "SpriteComponent", {
        _tags = "enabled_in_world, graham_speech_text",
        image_file = "data/fonts/font_pixel_white.xml",
        emissive = ModSettingGet("grahamsdialogue.visibility"),
        is_text_sprite = true,
        offset_x = string.len(text) * 1.9,
        offset_y = offset_y,
        alpha = 0.8,
        update_transform = true,
        update_transform_rotation = false,
        text = text,
        has_special_scale = true,
        special_scale_x = size,
        special_scale_y = size,
        z_index = -9000,
        never_ragdollify_on_death = true
    })

    local luacomp = EntityGetFirstComponentIncludingDisabled(entity, "LuaComponent", "graham_speech_quiet")
    if luacomp then EntityRemoveComponent(entity, luacomp) end

    EntityAddComponent2(entity, "LuaComponent", {
        _tags= "graham_speech_quiet",
        execute_every_n_frame=ModSettingGet("grahamsdialogue.length"),
        script_source_file="mods/grahamsdialogue/quiet.lua"
    })
end